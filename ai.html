<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>voltage. | ai</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<link rel="stylesheet" href="/config/custom.css"/>
<link rel="stylesheet" href="/config/main.css">

<style>
body,input,button,.message,.suggestion{font-family:"Ubuntu",sans-serif!important;font-weight:700}
:root{--blue:#003da5;--blue-dark:#002f82;--white:#fff;--muted:#cdd8ff}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--blue);color:#fff;height:100vh;display:flex;flex-direction:column}
.hero{text-align:center;margin-top:60px}
.hero h1{font-size:64px;font-weight:800}
.chat-wrapper{flex:1;display:flex;justify-content:center;align-items:flex-end;padding:30px 16px}
.chat{width:100%;max-width:720px;background:var(--blue-dark);border-radius:14px;display:flex;flex-direction:column;overflow:hidden}
.chat-body{flex:1;padding:16px;overflow-y:auto}
.message{margin-bottom:12px;line-height:1.5;font-size:15px;position:relative;padding:6px 12px;border-radius:6px;word-break:break-word}
.user-message{text-align:right;background:rgba(255,255,255,.05)}
.ai-message{background:rgba(255,255,255,.05);color:var(--muted)}

.edit-btn{
  position:absolute;top:-22px;right:6px;
  font-size:13px;cursor:pointer;
  background:rgba(0,0,0,.35);
  padding:2px 5px;border-radius:50%;
  display:none;
}
.user-message:hover .edit-btn{display:inline}

.ai-buttons{display:flex;gap:6px;margin-top:6px}
.ai-button{
  background:#003da5;
  border:none;
  color:#fff;
  padding:4px 6px;
  border-radius:4px;
  font-size:12px;
  cursor:pointer;
}

.chat-input{
  display:flex;gap:4px;padding:4px;
  border-top:1px solid #ffffff22;
  align-items:center
}
.chat-input input{
  flex:1;padding:12px;background:transparent;
  border:none;color:#fff;font-size:15px
}
.chat-input button{
  width:40px;height:40px;
  background:transparent;border:none;
  color:#fff;cursor:pointer
}
.clear-btn{color:#ff4b4b}

img{max-width:100%;border-radius:6px;margin-top:6px}
.footer{text-align:center;font-size:12px;opacity:.7;padding:10px}
</style>
</head>

<body>

<nav class="navbar">
  <div class="nav-left">
        <a href="/" class="nav-logo">
          <i class="fa-solid fa-bolt"></i> voltage.
        </a>
      </div>

      <div class="nav-right">
        <a href="/games.html" class="nav-link">
          <i class="fa-solid fa-gamepad"></i> Games
        </a>

        <div class="nav-right">
    <a href="/ai.html" class="nav-link">
      <i class="fa-solid fa-robot"></i> AI
    </a>

        </div>
      </div>
</nav>

<div class="hero"><h1>voltage.</h1></div>

<div class="chat-wrapper">
<div class="chat">
  <div class="chat-body" id="chatBody"></div>

  <div class="chat-input">
    <button class="clear-btn" id="clearChatBtn"><i class="fa-solid fa-trash"></i></button>
    <button class="ai-button" id="uploadBtn"><i class="fa-solid fa-paperclip"></i></button>
    <button class="ai-button" id="generateImageBtn"><i class="fa-solid fa-image"></i></button>
    <input id="aiInput" placeholder="Type a message...">
    <button id="sendMsg"><i class="fas fa-arrow-up"></i></button>
  </div>
</div>
</div>

<div class="footer">
  Credit to <a href="https://petezahgames.com/" style="color:#fff">PeteZah</a>
</div>

<script>
const chatBody=document.getElementById("chatBody");
const aiInput=document.getElementById("aiInput");
const sendMsg=document.getElementById("sendMsg");
const clearChatBtn=document.getElementById("clearChatBtn");
const uploadBtn=document.getElementById("uploadBtn");
const generateImageBtn=document.getElementById("generateImageBtn");

let messageHistory=[];

/* ===== Storage ===== */
function saveChat(){
  localStorage.setItem("voltageChat",JSON.stringify(messageHistory));
}
function loadChat(){
  const data=localStorage.getItem("voltageChat");
  if(data){
    messageHistory=JSON.parse(data);
    messageHistory.forEach(m=>renderMessage(m));
  }else{
    addMessage("Hi, how can I assist you today? I am voltage. ai ðŸ‘‹","ai");
  }
}

/* ===== Message Handling ===== */
function addMessage(content,role){
  const msg={id:Date.now()+Math.random(),role,content};
  messageHistory.push(msg);
  renderMessage(msg);
  saveChat();
}

function renderMessage(msg){
  const div=document.createElement("div");
  div.className=`message ${msg.role}-message`;

  if(msg.role==="user"){
    if(msg.content.startsWith("data:image")){
      const img=document.createElement("img");
      img.src=msg.content;
      div.appendChild(img);
    }else{
      div.textContent=msg.content;
    }

    const edit=document.createElement("span");
    edit.className="edit-btn";
    edit.textContent="âœŽ";
    edit.onclick=()=>{
      aiInput.value=msg.content;
      messageHistory=messageHistory.filter(m=>m.id!==msg.id);
      div.remove();
      saveChat();
    };
    div.appendChild(edit);
  }else{
    if(msg.content.startsWith("IMAGE::")){
      const img=document.createElement("img");
      img.src=msg.content.replace("IMAGE::","");
      div.appendChild(img);
    }else{
      div.textContent=msg.content;
    }

    const btns=document.createElement("div");
    btns.className="ai-buttons";

    const copy=document.createElement("button");
    copy.className="ai-button";
    copy.innerHTML='<i class="fa-regular fa-copy"></i>';
    copy.onclick=()=>navigator.clipboard.writeText(msg.content.replace("IMAGE::",""));

    const speak=document.createElement("button");
    speak.className="ai-button";
    speak.innerHTML='<i class="fa-solid fa-volume-up"></i>';
    speak.onclick=()=>{
      speechSynthesis.cancel();
      speechSynthesis.speak(
        new SpeechSynthesisUtterance(msg.content.replace("IMAGE::",""))
      );
    };

    btns.append(copy,speak);
    div.appendChild(btns);
  }

  chatBody.appendChild(div);
  chatBody.scrollTop=chatBody.scrollHeight;
}

/* ===== Send ===== */
sendMsg.onclick=sendMessage;
aiInput.addEventListener("keypress",e=>{if(e.key==="Enter")sendMessage()});

function buildContext(){
  return messageHistory
    .slice(-12)
    .map(m=>{
      if(m.content.startsWith("IMAGE::")) return `${m.role}: [Image generated]`;
      if(m.content.startsWith("data:image")) return `${m.role}: [Image uploaded]`;
      return `${m.role}: ${m.content}`;
    })
    .join("\n");
}

function sendMessage(){
  const text=aiInput.value.trim();
  if(!text)return;
  addMessage(text,"user");
  aiInput.value="";

  if(text.startsWith("/imagine")){
    const prompt=text.replace("/imagine","").trim() || "abstract art";
    const imgURL=`https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?seed=${Date.now()}`;
    addMessage("IMAGE::"+imgURL,"ai");
    return;
  }

  const context=buildContext();

  fetch(`https://text.pollinations.ai/${encodeURIComponent(context)}`)
    .then(r=>r.text())
    .then(t=>addMessage(t || "No response.","ai"))
    .catch(()=>addMessage("Error contacting AI.","ai"));
}

/* ===== Clear ===== */
clearChatBtn.onclick=()=>{
  if(confirm("Clear all chat history?")){
    localStorage.removeItem("voltageChat");
    chatBody.innerHTML="";
    messageHistory=[];
    addMessage("Hi, how can I assist you today?","ai");
  }
};

/* ===== Upload ===== */
const fileInput=document.createElement("input");
fileInput.type="file";
fileInput.accept="image/*";
fileInput.style.display="none";
document.body.appendChild(fileInput);

uploadBtn.onclick=()=>fileInput.click();
fileInput.onchange=()=>{
  const file=fileInput.files[0];
  if(!file)return;
  const reader=new FileReader();
  reader.onload=e=>addMessage(e.target.result,"user");
  reader.readAsDataURL(file);
};

/* ===== Image Button ===== */
generateImageBtn.onclick=()=>{
  aiInput.value="/imagine ";
  aiInput.focus();
};

loadChat();
</script>

</body>
</html>
